DROP TABLE IF EXISTS education_forms CASCADE;

CREATE TABLE education_forms
(
    id   INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

DROP TABLE IF EXISTS lesson_types CASCADE;

CREATE TABLE lesson_types
(
    id       INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name     VARCHAR(255) NOT NULL,
    duration INT CHECK (duration > 0)
);

DROP TABLE IF EXISTS faculties CASCADE;

CREATE TABLE faculties
(
    id          INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name        VARCHAR(255) NOT NULL,
    description TEXT
);

DROP TABLE IF EXISTS courses CASCADE;

CREATE TABLE courses
(
    id          INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name        VARCHAR(255) NOT NULL,
    description TEXT
);

DROP TABLE IF EXISTS teacher_titles CASCADE;

CREATE TABLE teacher_titles
(
    id   INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

DROP TABLE IF EXISTS users CASCADE;

CREATE TABLE users
(
    id               INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_type        VARCHAR(255),
    first_name       VARCHAR(255),
    last_name        VARCHAR(255),
    gender           INT CHECK (gender = 0 OR gender = 1),
    email            VARCHAR(255),
    password         VARCHAR(255),
    group_id         INT,
    teacher_title_id INT REFERENCES teacher_titles (id),
    department_id    INT
);

DROP TABLE IF EXISTS groups CASCADE;

CREATE TABLE groups
(
    id                INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name              VARCHAR(255) NOT NULL,
    faculty_id        INT REFERENCES faculties (id),
    head_user_id      INT REFERENCES users (id),
    education_form_id INT REFERENCES education_forms (id)
);

ALTER TABLE users
    ADD CONSTRAINT fk_student_group FOREIGN KEY (group_id) REFERENCES groups (id);

DROP TABLE IF EXISTS user_groups CASCADE;

CREATE TABLE user_groups
(
    user_id  INT REFERENCES users (id),
    group_id INT REFERENCES groups (id)
);


DROP TABLE IF EXISTS user_courses CASCADE;


CREATE TABLE user_courses
(
    user_id   INT REFERENCES users (id),
    course_id INT REFERENCES courses (id)
);

DROP TABLE IF EXISTS departments CASCADE;

CREATE TABLE departments
(
    id          INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name        VARCHAR(255) NOT NULL,
    description TEXT
);

ALTER TABLE users
    ADD CONSTRAINT fk_teacher_department
        FOREIGN KEY (department_id) REFERENCES departments (id);

DROP TABLE IF EXISTS department_courses CASCADE;

CREATE TABLE department_courses
(
    department_id INT REFERENCES departments (id),
    course_id     INT REFERENCES courses (id)
);

DROP TABLE IF EXISTS lessons CASCADE;

CREATE TABLE lessons
(
    id             INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name           VARCHAR(255),
    group_id       INT REFERENCES groups (id),
    user_id        INT REFERENCES users (id),
    course_id      INT REFERENCES courses (id),
    lesson_type_id INT REFERENCES lesson_types (id),
    start_time     TIMESTAMP
);
